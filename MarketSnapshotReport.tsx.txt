import React from 'react';
import { MarketSnapshotData } from './types';
import { PieChart, Pie, Cell, ResponsiveContainer } from 'recharts';

interface Props {
  data: MarketSnapshotData;
  reportRef: React.RefObject<HTMLDivElement | null>;
}

const Logo = () => (
  <div className="bg-orange-600 p-2.5 rounded-xl shadow-lg ring-4 ring-orange-600/10">
    <svg width="42" height="42" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M250 450C250 450 400 380 400 150V100H100V150C100 380 250 450 250 450Z" fill="white"/>
      <path d="M150 280C180 275 220 260 250 200C260 180 270 170 300 170C330 170 345 185 370 195C350 190 330 185 310 185C280 185 270 195 260 215C230 280 180 300 130 305L150 280Z" fill="#ea580c"/>
    </svg>
  </div>
);

const MarketSnapshotReport: React.FC<Props> = ({ data, reportRef }) => {
  const adData = [
    { name: 'Advances', value: data.advanceDecline.advances, color: '#10b981' },
    { name: 'Declines', value: data.advanceDecline.declines, color: '#ef4444' }
  ];

  const currentTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });

  return (
    <div 
      ref={reportRef}
      className="w-[800px] bg-white overflow-hidden relative flex flex-col border border-slate-200"
      style={{ minHeight: '1250px' }}
    >
      {/* Institutional Terminal Header */}
      <div className="bg-[#0f172a] text-white p-10 relative overflow-hidden">
        <div className="absolute top-0 right-0 w-96 h-96 bg-orange-600/5 rounded-full -mr-48 -mt-48 blur-[80px]"></div>
        <div className="absolute bottom-0 left-0 w-full h-[4px] bg-gradient-to-r from-orange-600 to-transparent"></div>
        <div className="relative flex justify-between items-end">
            <div className="flex items-center gap-6">
                <Logo />
                <div>
                    <h1 className="text-4xl font-black uppercase tracking-tighter leading-none mb-2">Vivek Financial</h1>
                    <div className="flex items-center gap-2">
                        <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
                        <p className="text-[10px] font-bold tracking-[0.4em] text-slate-400 uppercase">Institutional Market Intelligence</p>
                    </div>
                </div>
            </div>
            <div className="text-right">
                <div className="text-[10px] font-black text-orange-500 uppercase tracking-widest mb-1">CLOSING SNAPSHOT</div>
                <div className="text-3xl font-black tracking-tight mb-1 tabular-nums">{data.date}</div>
                <div className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Update Issued at {currentTime}</div>
            </div>
        </div>
      </div>

      {/* Primary Indices Dashboard */}
      <div className="grid grid-cols-3 divide-x divide-slate-100 bg-slate-50 border-b border-slate-100">
        {[
          { label: 'NIFTY 50', val: data.indices.nifty50 },
          { label: 'SENSEX', val: data.indices.sensex },
          { label: 'NIFTY BANK', val: data.indices.niftyBank }
        ].map((index, i) => (
          <div key={i} className="p-8 group hover:bg-slate-100 transition-colors">
            <div className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2">{index.label}</div>
            <div className="text-3xl font-black text-slate-900 leading-none mb-3 tabular-nums tracking-tighter">{index.val.value}</div>
            <div className={`flex items-center gap-2 font-bold text-sm ${index.val.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                <span className="text-lg">{index.val.isPositive ? '▲' : '▼'}</span>
                {index.val.change} <span className="text-[11px] bg-white px-2 py-0.5 rounded-full border border-slate-200">({index.val.percentChange})</span>
            </div>
          </div>
        ))}
      </div>

      {/* Breadth & Commodity Pulse */}
      <div className="grid grid-cols-2 border-b border-slate-100 h-[320px]">
        <div className="p-10 border-r border-slate-100">
          <div className="flex items-center justify-between mb-8">
            <h4 className="font-black text-slate-800 text-[11px] uppercase tracking-[0.2em]">Market Breadth (NSE)</h4>
            <span className="text-[9px] font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded tracking-widest">REAL-TIME DATA</span>
          </div>
          <div className="flex items-center gap-8">
            <div className="w-40 h-40 relative">
                <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                        <Pie data={adData} innerRadius={55} outerRadius={70} paddingAngle={6} dataKey="value" stroke="none">
                            {adData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                        </Pie>
                    </PieChart>
                </ResponsiveContainer>
                <div className="absolute inset-0 flex flex-col items-center justify-center">
                    <span className="text-2xl font-black text-slate-900 leading-none">{data.advanceDecline.advancePercent}</span>
                    <span className="text-[8px] font-bold text-slate-400 uppercase tracking-widest mt-1">Advances</span>
                </div>
            </div>
            <div className="flex-1 space-y-4">
                <div className="p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-[9px] font-black text-emerald-600 uppercase">Advances</span>
                        <i className="fa-solid fa-arrow-trend-up text-emerald-400 text-[10px]"></i>
                    </div>
                    <div className="text-2xl font-black text-slate-900 tabular-nums">{data.advanceDecline.advances}</div>
                </div>
                <div className="p-4 rounded-2xl bg-white border border-slate-100 shadow-sm">
                    <div className="flex justify-between items-center mb-1">
                        <span className="text-[9px] font-black text-rose-600 uppercase">Declines</span>
                        <i className="fa-solid fa-arrow-trend-down text-rose-400 text-[10px]"></i>
                    </div>
                    <div className="text-2xl font-black text-slate-900 tabular-nums">{data.advanceDecline.declines}</div>
                </div>
            </div>
          </div>
        </div>

        <div className="bg-slate-50/50 divide-y divide-slate-100">
          {[
            { label: 'Gold (MCX 10g)', data: data.commodities.gold, icon: 'fa-coins' },
            { label: 'Brent Crude ($)', data: data.commodities.oil, icon: 'fa-droplet' },
            { label: 'USD / INR Spot', data: data.commodities.usdInr, icon: 'fa-dollar-sign' }
          ].map((c, i) => (
            <div key={i} className="px-10 py-[22px] flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="w-10 h-10 rounded-xl bg-white border border-slate-200 flex items-center justify-center text-slate-400 shadow-sm">
                  <i className={`fa-solid ${c.icon} text-sm`}></i>
                </div>
                <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">{c.label}</span>
              </div>
              <div className="text-right">
                <div className="font-black text-slate-900 text-xl tabular-nums tracking-tight">{c.data.value}</div>
                <div className={`text-[10px] font-bold ${c.data.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                  {c.data.isPositive ? '▲' : '▼'} {c.data.percentChange}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Movers & Performance Section */}
      <div className="grid grid-cols-2 divide-x divide-slate-100 flex-1">
        <div className="p-10">
          <div className="flex items-center justify-between mb-8">
            <h4 className="font-black text-slate-800 text-[11px] uppercase tracking-widest border-l-4 border-emerald-500 pl-4">Top Gainers</h4>
            <span className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">NSE NIFTY 50</span>
          </div>
          <div className="space-y-2">
            {data.gainers.slice(0, 5).map((s, i) => (
              <div key={i} className="flex items-center justify-between py-4 border-b border-slate-50 hover:bg-emerald-50/50 rounded-xl px-3 transition-colors">
                <div className="font-black text-slate-800 text-sm tracking-tight">{s.company}</div>
                <div className="text-right">
                  <div className="text-xs font-bold text-slate-400 mb-0.5 tabular-nums">{s.price}</div>
                  <div className="text-sm font-black text-emerald-600">+{s.percentChange}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        <div className="p-10">
          <div className="flex items-center justify-between mb-8">
            <h4 className="font-black text-slate-800 text-[11px] uppercase tracking-widest border-l-4 border-rose-500 pl-4">Top Losers</h4>
            <span className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">NSE NIFTY 50</span>
          </div>
          <div className="space-y-2">
            {data.losers.slice(0, 5).map((s, i) => (
              <div key={i} className="flex items-center justify-between py-4 border-b border-slate-50 hover:bg-rose-50/50 rounded-xl px-3 transition-colors">
                <div className="font-black text-slate-800 text-sm tracking-tight">{s.company}</div>
                <div className="text-right">
                  <div className="text-xs font-bold text-slate-400 mb-0.5 tabular-nums">{s.price}</div>
                  <div className="text-sm font-black text-rose-600">{s.percentChange}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Institutional Activity Block */}
      <div className="px-10 py-10 bg-slate-50/50 border-t border-slate-100">
          <h4 className="font-black text-slate-400 text-[10px] uppercase tracking-[0.4em] mb-10 text-center">INSTITUTIONAL CASH FLOW (₹ Cr)</h4>
          <div className="grid grid-cols-2 gap-8">
              <div className="bg-[#0f172a] rounded-[2rem] p-8 text-white relative overflow-hidden group">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-orange-600/10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                  <div className="flex justify-between items-start mb-8 relative z-10">
                      <span className="text-[10px] font-black text-orange-400 uppercase tracking-widest">FII FLOWS</span>
                      <i className="fa-solid fa-landmark text-slate-700"></i>
                  </div>
                  <div className="flex justify-between items-center relative z-10">
                      <div>
                          <p className="text-[9px] font-black text-slate-500 uppercase mb-2">Today Net</p>
                          <p className={`text-3xl font-black tabular-nums ${data.fii.daily.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.fii.daily.net}</p>
                      </div>
                      <div className="h-10 w-[1px] bg-slate-800"></div>
                      <div className="text-right">
                          <p className="text-[9px] font-black text-slate-500 uppercase mb-2">MTD Net</p>
                          <p className={`text-xl font-black tabular-nums ${data.fii.mtd.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.fii.mtd.net}</p>
                      </div>
                  </div>
              </div>
              <div className="bg-[#0f172a] rounded-[2rem] p-8 text-white relative overflow-hidden group">
                  <div className="absolute top-0 right-0 w-32 h-32 bg-blue-600/10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                  <div className="flex justify-between items-start mb-8 relative z-10">
                      <span className="text-[10px] font-black text-blue-400 uppercase tracking-widest">DII FLOWS</span>
                      <i className="fa-solid fa-vault text-slate-700"></i>
                  </div>
                  <div className="flex justify-between items-center relative z-10">
                      <div>
                          <p className="text-[9px] font-black text-slate-500 uppercase mb-2">Today Net</p>
                          <p className={`text-3xl font-black tabular-nums ${data.dii.daily.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.dii.daily.net}</p>
                      </div>
                      <div className="h-10 w-[1px] bg-slate-800"></div>
                      <div className="text-right">
                          <p className="text-[9px] font-black text-slate-500 uppercase mb-2">MTD Net</p>
                          <p className={`text-xl font-black tabular-nums ${data.dii.mtd.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.dii.mtd.net}</p>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      {/* Institutional Footer */}
      <div className="bg-slate-100 p-10 mt-auto border-t border-slate-200">
          <div className="flex items-center justify-between mb-8 pb-8 border-b border-slate-200">
            <div>
              <div className="text-slate-900 font-black text-2xl tracking-tighter mb-1 uppercase italic">Vivek Financial Focus Ltd.</div>
              <p className="text-[9px] font-bold text-slate-500 uppercase tracking-[0.2em] leading-relaxed">
                SEBI Registered Stock Broker | Member: NSE & BSE, DP: NDSL, AMFI - MF Distributor, Bonds
              </p>
            </div>
            <div className="text-right">
                <div className="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-1">ACCESS PORTAL</div>
                <div className="text-lg font-black text-slate-900 tracking-tight">www.vivekfinancial.com</div>
            </div>
          </div>
          <p className="text-[9px] font-medium text-slate-400 text-center uppercase leading-relaxed max-w-2xl mx-auto italic opacity-60">
            Disclaimer: Stock market investments are subject to market risks. Please read all related documents carefully before investing. Data summarized automatically for client convenience.
          </p>
      </div>
    </div>
  );
};

export default MarketSnapshotReport;