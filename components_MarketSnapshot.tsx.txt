import React from 'react';
import { MarketSnapshotData } from '../types';
import { PieChart, Pie, Cell, ResponsiveContainer } from 'recharts';

interface Props {
  data: MarketSnapshotData;
  reportRef: React.RefObject<HTMLDivElement | null>;
}

const Logo = () => (
  <div className="bg-orange-600 p-2.5 rounded-xl shadow-lg ring-4 ring-orange-600/20">
    <svg width="40" height="40" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M250 450C250 450 400 380 400 150V100H100V150C100 380 250 450 250 450Z" fill="white"/>
      <path d="M150 280C180 275 220 260 250 200C260 180 270 170 300 170C330 170 345 185 370 195C350 190 330 185 310 185C280 185 270 195 260 215C230 280 180 300 130 305L150 280Z" fill="#F38220"/>
    </svg>
  </div>
);

const MarketSnapshotReport: React.FC<Props> = ({ data, reportRef }) => {
  const adData = [
    { name: 'Advances', value: data.advanceDecline.advances, color: '#10b981' },
    { name: 'Declines', value: data.advanceDecline.declines, color: '#ef4444' }
  ];

  const currentTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });

  return (
    <div 
      ref={reportRef}
      className="w-[800px] bg-white overflow-hidden relative flex flex-col"
      style={{ minHeight: '1150px' }}
    >
      {/* Header Section */}
      <div className="bg-[#0f172a] text-white p-10 border-b-[8px] border-orange-600 relative overflow-hidden">
        <div className="absolute top-0 right-0 w-96 h-96 bg-orange-600/5 rounded-full -mr-48 -mt-48 blur-3xl"></div>
        <div className="relative flex justify-between items-start">
            <div className="flex items-center gap-6">
                <Logo />
                <div>
                    <h1 className="text-4xl font-black uppercase tracking-tighter leading-none text-white">Vivek Financial</h1>
                    <div className="flex items-center gap-2 mt-2">
                        <span className="h-0.5 w-6 bg-orange-500"></span>
                        <p className="text-[10px] font-bold tracking-[0.4em] text-orange-400 uppercase leading-none">Focus on your success</p>
                    </div>
                </div>
            </div>
            <div className="text-right">
                <div className="bg-orange-600 text-white px-3 py-1 text-[9px] font-black uppercase tracking-widest inline-block mb-3 rounded-sm">INSTITUTIONAL GRADE REPORT</div>
                <div className="text-3xl font-black tabular-nums">{data.date}</div>
                <div className="text-[10px] font-bold text-slate-400 mt-1 uppercase tracking-widest">Post-Market Intel • {currentTime}</div>
            </div>
        </div>
      </div>

      {/* Main Indices Bar */}
      <div className="grid grid-cols-3 divide-x divide-slate-100 border-b border-slate-100 bg-slate-50/40">
        {[
          { label: 'NIFTY 50', val: data.indices.nifty50 },
          { label: 'SENSEX', val: data.indices.sensex },
          { label: 'NIFTY BANK', val: data.indices.niftyBank }
        ].map((index, i) => (
          <div key={i} className="p-8">
            <div className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] mb-3">{index.label}</div>
            <div className="text-3xl font-black text-slate-900 leading-none mb-4 tabular-nums tracking-tighter">{index.val.value}</div>
            <div className={`flex items-center gap-2 font-bold text-sm ${index.val.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                <span className="text-lg leading-none">{index.val.isPositive ? '▲' : '▼'}</span>
                {index.val.change} <span className="text-[10px] bg-slate-100 px-1.5 py-0.5 rounded opacity-70">({index.val.percentChange})</span>
            </div>
          </div>
        ))}
      </div>

      {/* Market Breadth & Macro Pulse */}
      <div className="grid grid-cols-2 divide-x divide-slate-100 border-b border-slate-100">
        <div className="p-10">
          <h4 className="font-black text-slate-800 text-xs uppercase tracking-widest mb-10 border-l-4 border-emerald-500 pl-3">Market Breadth (NSE)</h4>
          <div className="flex items-center justify-between gap-10">
            <div className="w-36 h-36 relative">
                <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                        <Pie data={adData} innerRadius={45} outerRadius={60} paddingAngle={8} dataKey="value" stroke="none">
                            {adData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                        </Pie>
                    </PieChart>
                </ResponsiveContainer>
                <div className="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                    <span className="text-xs font-black text-slate-900 leading-none">{data.advanceDecline.advancePercent}</span>
                    <span className="text-[8px] font-bold text-slate-400 uppercase mt-1">POSITIVE</span>
                </div>
            </div>
            <div className="flex-1 space-y-6">
                <div className="flex justify-between items-end border-b border-slate-100 pb-2">
                    <span className="text-[10px] font-black text-emerald-600 uppercase tracking-widest">Advances</span>
                    <span className="text-3xl font-black text-slate-900 leading-none">{data.advanceDecline.advances}</span>
                </div>
                <div className="flex justify-between items-end border-b border-slate-100 pb-2">
                    <span className="text-[10px] font-black text-rose-600 uppercase tracking-widest">Declines</span>
                    <span className="text-3xl font-black text-slate-900 leading-none">{data.advanceDecline.declines}</span>
                </div>
            </div>
          </div>
        </div>

        <div className="bg-slate-50/30 divide-y divide-slate-100">
          {[
            { label: 'Gold (10g MCX)', data: data.commodities.gold, icon: 'fa-coins' },
            { label: 'Brent Crude ($)', data: data.commodities.oil, icon: 'fa-droplet' },
            { label: 'USD / INR Spot', data: data.commodities.usdInr, icon: 'fa-dollar-sign' }
          ].map((c, i) => (
            <div key={i} className="px-10 py-6 flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className="w-8 h-8 rounded-lg bg-white border border-slate-200 flex items-center justify-center text-slate-400 shadow-sm">
                  <i className={`fa-solid ${c.icon} text-xs`}></i>
                </div>
                <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">{c.label}</span>
              </div>
              <div className="text-right">
                <div className="font-black text-slate-900 text-2xl tabular-nums tracking-tighter">{c.data.value}</div>
                <div className={`text-[9px] font-black mt-1 ${c.data.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                  {c.data.isPositive ? '▲' : '▼'} {c.data.percentChange}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Gainers & Losers Section */}
      <div className="grid grid-cols-2 divide-x divide-slate-100 flex-1">
        <div className="p-10">
          <div className="flex items-center gap-3 mb-8">
            <div className="bg-emerald-500 w-1.5 h-6 rounded-full"></div>
            <h4 className="font-black text-slate-800 text-xs uppercase tracking-widest">NSE Top Gainers</h4>
          </div>
          <table className="w-full">
            <tbody className="divide-y divide-slate-50">
              {data.gainers.slice(0, 5).map((s, i) => (
                <tr key={i} className="group">
                  <td className="py-4 font-black text-slate-900 text-sm tracking-tight">{s.company}</td>
                  <td className="text-right py-4 font-bold text-slate-400 tabular-nums text-xs">{s.price}</td>
                  <td className="text-right py-4 font-black text-emerald-600 tabular-nums text-sm">+{s.percentChange}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="p-10">
          <div className="flex items-center gap-3 mb-8">
            <div className="bg-rose-500 w-1.5 h-6 rounded-full"></div>
            <h4 className="font-black text-slate-800 text-xs uppercase tracking-widest">NSE Top Losers</h4>
          </div>
          <table className="w-full">
            <tbody className="divide-y divide-slate-50">
              {data.losers.slice(0, 5).map((s, i) => (
                <tr key={i} className="group">
                  <td className="py-4 font-black text-slate-900 text-sm tracking-tight">{s.company}</td>
                  <td className="text-right py-4 font-bold text-slate-400 tabular-nums text-xs">{s.price}</td>
                  <td className="text-right py-4 font-black text-rose-600 tabular-nums text-sm">{s.percentChange}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {/* Institutional Activity (FII/DII) */}
      <div className="p-10 bg-slate-50 border-t border-slate-100">
          <h4 className="font-black text-slate-800 text-xs uppercase tracking-widest mb-8 text-center opacity-60">Institutional Cash Segment Activity (₹ Cr)</h4>
          <div className="grid grid-cols-2 gap-8">
              <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                  <div className="text-[9px] font-black text-slate-400 uppercase mb-5 tracking-[0.2em] text-center border-b border-slate-50 pb-3">Daily Net Flow</div>
                  <div className="flex justify-between items-center px-4">
                      <div className="text-center">
                          <div className="text-[9px] font-bold text-slate-500 mb-1 uppercase tracking-widest">FII</div>
                          <div className={`text-2xl font-black tabular-nums ${data.fii.daily.net.includes('-') ? 'text-rose-600' : 'text-emerald-600'}`}>{data.fii.daily.net}</div>
                      </div>
                      <div className="w-px h-10 bg-slate-100"></div>
                      <div className="text-center">
                          <div className="text-[9px] font-bold text-slate-500 mb-1 uppercase tracking-widest">DII</div>
                          <div className={`text-2xl font-black tabular-nums ${data.dii.daily.net.includes('-') ? 'text-rose-600' : 'text-emerald-600'}`}>{data.dii.daily.net}</div>
                      </div>
                  </div>
              </div>
              <div className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm">
                  <div className="text-[9px] font-black text-slate-400 uppercase mb-5 tracking-[0.2em] text-center border-b border-slate-50 pb-3">Month Till Date (MTD)</div>
                  <div className="flex justify-between items-center px-4">
                      <div className="text-center">
                          <div className="text-[9px] font-bold text-slate-500 mb-1 uppercase tracking-widest">FII</div>
                          <div className={`text-2xl font-black tabular-nums ${data.fii.mtd.net.includes('-') ? 'text-rose-600' : 'text-emerald-600'}`}>{data.fii.mtd.net}</div>
                      </div>
                      <div className="w-px h-10 bg-slate-100"></div>
                      <div className="text-center">
                          <div className="text-[9px] font-bold text-slate-500 mb-1 uppercase tracking-widest">DII</div>
                          <div className={`text-2xl font-black tabular-nums ${data.dii.mtd.net.includes('-') ? 'text-rose-600' : 'text-emerald-600'}`}>{data.dii.mtd.net}</div>
                      </div>
                  </div>
              </div>
          </div>
      </div>

      {/* Footer Disclaimer */}
      <div className="bg-[#0f172a] text-white p-10 mt-auto">
          <div className="flex items-center justify-between mb-8 pb-8 border-b border-slate-800">
            <div>
              <div className="text-orange-500 font-black text-2xl tracking-tighter mb-2 uppercase">Vivek Financial Focus Ltd.</div>
              <p className="text-[9px] font-bold text-slate-500 uppercase tracking-[0.2em] leading-relaxed max-w-sm">
                SEBI: INZ000276333 | NSE & BSE Member | CDSL DP: 473-2020 | ARN 19901
              </p>
            </div>
            <div className="text-right">
                <div className="text-[9px] font-black text-slate-600 uppercase tracking-widest mb-2">wealth portal</div>
                <div className="text-lg font-black tracking-tight">www.vivekfinancial.com</div>
            </div>
          </div>
          <p className="text-[9px] font-medium text-slate-600 text-center uppercase leading-relaxed max-w-2xl mx-auto opacity-50 italic">
            Disclaimer: Investments in the securities market are subject to market risks. Read all related documents carefully before investing. AI-generated data; please verify with exchange reports.
          </p>
      </div>
    </div>
  );
};

export default MarketSnapshotReport;