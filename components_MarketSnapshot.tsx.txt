
import React from 'react';
import { MarketSnapshotData } from '../types';
import { PieChart, Pie, Cell, ResponsiveContainer } from 'recharts';

interface Props {
  data: MarketSnapshotData;
  reportRef: React.RefObject<HTMLDivElement>;
}

const Logo = () => (
  <svg width="60" height="60" viewBox="0 0 500 500" fill="none" xmlns="http://www.w3.org/2000/svg" className="drop-shadow-sm">
    <path d="M250 450C250 450 400 380 400 150V100H100V150C100 380 250 450 250 450Z" fill="#F38220"/>
    <path d="M150 280C180 275 220 260 250 200C260 180 270 170 300 170C330 170 345 185 370 195C350 190 330 185 310 185C280 185 270 195 260 215C230 280 180 300 130 305L150 280Z" fill="white"/>
    <circle cx="315" cy="188" r="8" fill="#F38220"/>
  </svg>
);

const MarketSnapshotReport: React.FC<Props> = ({ data, reportRef }) => {
  const adData = [
    { name: 'Advances', value: data.advanceDecline.advances, color: '#10B981' },
    { name: 'Declines', value: data.advanceDecline.declines, color: '#EF4444' }
  ];

  return (
    <div 
      ref={reportRef}
      className="w-[800px] bg-[#ffffff] border border-gray-200 overflow-hidden shadow-2xl relative report-font"
      style={{ minHeight: '1000px' }}
    >
      {/* Header */}
      <div className="bg-white flex justify-between items-center px-6 py-4 border-b-4 border-orange-500">
        <div className="bg-gray-800 text-white px-6 py-2 font-bold skew-x-[-12deg] shadow-md">
          <span className="block skew-x-[12deg] text-base uppercase tracking-widest">Market Snapshot</span>
        </div>
        
        <div className="flex items-center gap-4">
            <Logo />
            <div className="flex flex-col">
                <span className="text-[#F38220] text-3xl font-black tracking-tighter leading-none uppercase">Vivek Financial</span>
                <span className="text-gray-500 text-[10px] font-bold tracking-[0.2em] uppercase mt-1">Focusing on your growth</span>
            </div>
        </div>

        <div className="bg-gray-800 text-white px-6 py-2 font-bold skew-x-[-12deg] shadow-md">
          <span className="block skew-x-[12deg] text-base">{data.date}</span>
        </div>
      </div>

      {/* Main Indices Section */}
      <div className="grid grid-cols-2 gap-4 px-6 py-4 bg-gray-50">
        {/* Nifty 50 */}
        <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-1 h-6 bg-orange-500 rounded-full"></div>
            <h3 className="font-extrabold text-gray-800 text-lg uppercase">NSE Nifty 50</h3>
          </div>
          <div className="flex justify-between items-end">
            <span className="text-4xl font-black text-gray-800 tracking-tight">{data.indices.nifty50.value}</span>
            <div className="text-right">
              <div className={`text-xl font-bold flex items-center justify-end gap-1 ${data.indices.nifty50.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                {data.indices.nifty50.isPositive ? <i className="fa-solid fa-caret-up"></i> : <i className="fa-solid fa-caret-down"></i>}
                {data.indices.nifty50.change}
              </div>
              <div className={`text-sm font-bold ${data.indices.nifty50.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                ({data.indices.nifty50.percentChange})
              </div>
            </div>
          </div>
        </div>

        {/* BSE Sensex */}
        <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-1 h-6 bg-orange-500 rounded-full"></div>
            <h3 className="font-extrabold text-gray-800 text-lg uppercase">BSE Sensex</h3>
          </div>
          <div className="flex justify-between items-end">
            <span className="text-4xl font-black text-gray-800 tracking-tight">{data.indices.sensex.value}</span>
            <div className="text-right">
              <div className={`text-xl font-bold flex items-center justify-end gap-1 ${data.indices.sensex.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                {data.indices.sensex.isPositive ? <i className="fa-solid fa-caret-up"></i> : <i className="fa-solid fa-caret-down"></i>}
                {data.indices.sensex.change}
              </div>
              <div className={`text-sm font-bold ${data.indices.sensex.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                ({data.indices.sensex.percentChange})
              </div>
            </div>
          </div>
        </div>

        {/* Nifty Bank */}
        <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-1 h-6 bg-orange-500 rounded-full"></div>
            <h3 className="font-extrabold text-gray-800 text-lg uppercase">NSE Nifty Bank</h3>
          </div>
          <div className="flex justify-between items-end">
            <span className="text-4xl font-black text-gray-800 tracking-tight">{data.indices.niftyBank.value}</span>
            <div className="text-right">
              <div className={`text-xl font-bold flex items-center justify-end gap-1 ${data.indices.niftyBank.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                {data.indices.niftyBank.isPositive ? <i className="fa-solid fa-caret-up"></i> : <i className="fa-solid fa-caret-down"></i>}
                {data.indices.niftyBank.change}
              </div>
              <div className={`text-sm font-bold ${data.indices.niftyBank.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                ({data.indices.niftyBank.percentChange})
              </div>
            </div>
          </div>
        </div>

        {/* Gold */}
        <div className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
          <div className="flex items-center gap-2 mb-2">
            <div className="w-1 h-6 bg-yellow-500 rounded-full"></div>
            <h3 className="font-extrabold text-gray-800 text-lg uppercase">Gold (10gm)</h3>
          </div>
          <div className="flex justify-between items-end">
            <span className="text-4xl font-black text-gray-800 tracking-tight">{data.commodities.gold.value}</span>
            <div className="text-right">
              <div className={`text-xl font-bold flex items-center justify-end gap-1 ${data.commodities.gold.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                {data.commodities.gold.isPositive ? <i className="fa-solid fa-caret-up"></i> : <i className="fa-solid fa-caret-down"></i>}
                {data.commodities.gold.change}
              </div>
              <div className="text-xs text-gray-400 font-bold uppercase mt-1">MCX 05 FEB</div>
            </div>
          </div>
        </div>
      </div>

      {/* Gainers / Losers */}
      <div className="grid grid-cols-2 gap-0 border-t border-b border-gray-100">
        <div className="border-r border-gray-100 p-6 bg-[#f0fff4]">
          <div className="flex items-center gap-2 mb-4">
             <i className="fa-solid fa-arrow-trend-up text-green-600 text-xl"></i>
             <h4 className="text-green-800 font-black text-lg uppercase tracking-tight">Top Gainers - Nifty 50</h4>
          </div>
          <table className="w-full text-sm">
            <thead>
              <tr className="text-gray-500 border-b border-green-100">
                <th className="text-left py-2 font-bold uppercase text-[10px]">Symbol</th>
                <th className="text-right py-2 font-bold uppercase text-[10px]">LTP</th>
                <th className="text-right py-2 font-bold uppercase text-[10px]">% Chg</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-green-50">
              {data.gainers.map((stock, i) => (
                <tr key={i} className="font-bold text-gray-700">
                  <td className="py-2.5">{stock.company}</td>
                  <td className="text-right py-2.5">{stock.price}</td>
                  <td className="text-right py-2.5 text-green-600">+{stock.percentChange}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
        <div className="p-6 bg-[#fff5f5]">
          <div className="flex items-center gap-2 mb-4">
             <i className="fa-solid fa-arrow-trend-down text-red-600 text-xl"></i>
             <h4 className="text-red-800 font-black text-lg uppercase tracking-tight">Top Losers - Nifty 50</h4>
          </div>
          <table className="w-full text-sm">
            <thead>
              <tr className="text-gray-500 border-b border-red-100">
                <th className="text-left py-2 font-bold uppercase text-[10px]">Symbol</th>
                <th className="text-right py-2 font-bold uppercase text-[10px]">LTP</th>
                <th className="text-right py-2 font-bold uppercase text-[10px]">% Chg</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-red-50">
              {data.losers.map((stock, i) => (
                <tr key={i} className="font-bold text-gray-700">
                  <td className="py-2.5">{stock.company}</td>
                  <td className="text-right py-2.5">{stock.price}</td>
                  <td className="text-right py-2.5 text-red-600">{stock.percentChange}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {/* Advance Decline & Global Commodities */}
      <div className="grid grid-cols-2 gap-0 border-b border-gray-100">
        <div className="border-r border-gray-100 p-6 flex flex-col items-center justify-center bg-gray-50">
          <h4 className="font-black text-gray-800 uppercase text-xs mb-4 tracking-widest">Market Breadth (NSE)</h4>
          <div className="w-full h-40 relative">
             <ResponsiveContainer width="100%" height="100%">
               <PieChart>
                 <Pie
                   data={adData}
                   cx="50%"
                   cy="50%"
                   innerRadius={45}
                   outerRadius={65}
                   paddingAngle={4}
                   dataKey="value"
                   stroke="none"
                 >
                   {adData.map((entry, index) => (
                     <Cell key={`cell-${index}`} fill={entry.color} />
                   ))}
                 </Pie>
               </PieChart>
             </ResponsiveContainer>
             <div className="absolute top-1/2 left-0 w-full flex justify-between transform -translate-y-1/2 px-4 pointer-events-none">
                <div className="text-center">
                    <div className="text-sm font-black text-green-600">{data.advanceDecline.advances}</div>
                    <div className="text-[10px] text-gray-400 font-bold">ADVANCES</div>
                </div>
                <div className="text-center">
                    <div className="text-sm font-black text-red-600">{data.advanceDecline.declines}</div>
                    <div className="text-[10px] text-gray-400 font-bold">DECLINES</div>
                </div>
             </div>
          </div>
        </div>
        <div className="grid grid-rows-2">
           <div className="p-6 flex flex-col justify-center border-b border-gray-100">
              <h4 className="font-black text-gray-500 uppercase text-[10px] mb-1 tracking-widest">Brent Crude Oil ($)</h4>
              <div className="flex justify-between items-end">
                 <span className="text-3xl font-black text-gray-800">{data.commodities.oil.value}</span>
                 <span className={`text-lg font-bold ${data.commodities.oil.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                    {data.commodities.oil.isPositive ? '+' : ''}{data.commodities.oil.change}
                 </span>
              </div>
           </div>
           <div className="p-6 flex flex-col justify-center">
              <h4 className="font-black text-gray-500 uppercase text-[10px] mb-1 tracking-widest">USD to INR (₹)</h4>
              <div className="flex justify-between items-end">
                 <span className="text-3xl font-black text-gray-800">{data.commodities.usdInr.value}</span>
                 <span className={`text-lg font-bold ${data.commodities.usdInr.isPositive ? 'text-green-600' : 'text-red-600'}`}>
                    {data.commodities.usdInr.isPositive ? '+' : ''}{data.commodities.usdInr.change}
                 </span>
              </div>
           </div>
        </div>
      </div>

      {/* FII / DII Institutional Activity */}
      <div className="px-6 py-6 bg-orange-50/50">
          <div className="flex items-center gap-3 mb-6">
              <div className="w-8 h-8 bg-[#F38220] flex items-center justify-center text-white rounded">
                 <i className="fa-solid fa-building-columns"></i>
              </div>
              <h4 className="font-black text-gray-800 text-xl uppercase tracking-tighter">Institutional Cash Flow (₹ Cr.)</h4>
          </div>

          <div className="grid grid-cols-7 text-[10px] font-black text-gray-400 uppercase mb-2 px-2">
              <div className="col-span-1">Period</div>
              <div className="text-center">FII Buy</div>
              <div className="text-center">FII Sell</div>
              <div className="text-center border-r border-orange-200">FII Net</div>
              <div className="text-center">DII Buy</div>
              <div className="text-center">DII Sell</div>
              <div className="text-center">DII Net</div>
          </div>
          
          <div className="space-y-2">
              {/* MTD Row */}
              <div className="grid grid-cols-7 bg-white p-3 rounded-lg border border-orange-100 shadow-sm text-center items-center">
                  <div className="col-span-1 text-left font-black text-gray-800 text-xs uppercase">MTD</div>
                  <div className="text-xs font-bold text-gray-600">{data.fii.mtd.grossPurchase}</div>
                  <div className="text-xs font-bold text-gray-600">{data.fii.mtd.grossSales}</div>
                  <div className={`text-sm font-black border-r border-orange-100 ${data.fii.mtd.net.startsWith('-') ? 'text-red-600' : 'text-green-600'}`}>{data.fii.mtd.net}</div>
                  <div className="text-xs font-bold text-gray-600">{data.dii.mtd.grossPurchase}</div>
                  <div className="text-xs font-bold text-gray-600">{data.dii.mtd.grossSales}</div>
                  <div className={`text-sm font-black ${data.dii.mtd.net.startsWith('-') ? 'text-red-600' : 'text-green-600'}`}>{data.dii.mtd.net}</div>
              </div>

              {/* Daily Row */}
              <div className="grid grid-cols-7 bg-white p-3 rounded-lg border border-orange-100 shadow-sm text-center items-center">
                  <div className="col-span-1 text-left font-black text-gray-800 text-xs uppercase">Daily</div>
                  <div className="text-xs font-bold text-gray-600">{data.fii.daily.grossPurchase}</div>
                  <div className="text-xs font-bold text-gray-600">{data.fii.daily.grossSales}</div>
                  <div className={`text-sm font-black border-r border-orange-100 ${data.fii.daily.net.startsWith('-') ? 'text-red-600' : 'text-green-600'}`}>{data.fii.daily.net}</div>
                  <div className="text-xs font-bold text-gray-600">{data.dii.daily.grossPurchase}</div>
                  <div className="text-xs font-bold text-gray-600">{data.dii.daily.grossSales}</div>
                  <div className={`text-sm font-black ${data.dii.daily.net.startsWith('-') ? 'text-red-600' : 'text-green-600'}`}>{data.dii.daily.net}</div>
              </div>
          </div>
      </div>

      {/* Footer Branding Bar */}
      <div className="bg-[#F38220] text-white text-[11px] font-black flex justify-center items-center space-x-6 py-3 uppercase tracking-wider">
          <span>Trading</span>
          <div className="w-1.5 h-1.5 bg-white rounded-full opacity-50"></div>
          <span>Mutual Funds</span>
          <div className="w-1.5 h-1.5 bg-white rounded-full opacity-50"></div>
          <span>IPOs</span>
          <div className="w-1.5 h-1.5 bg-white rounded-full opacity-50"></div>
          <span>Bonds</span>
          <div className="w-1.5 h-1.5 bg-white rounded-full opacity-50"></div>
          <span>Demat Accounts</span>
      </div>

      {/* Regulatory Footer */}
      <div className="bg-gray-100 p-6 text-center">
          <div className="text-gray-800 font-black text-sm mb-1 uppercase tracking-tight">
              Vivek Financial Focus Ltd.
          </div>
          <div className="text-gray-600 font-bold text-[10px] uppercase opacity-75">
              MEMBER: NSE, BSE, SEBI Reg. No. INZ000276333 | DP: NSDL IN-DP-473-2020 | AMFI Reg No. : ARN 19901
          </div>
          <div className="max-w-[600px] mx-auto text-gray-400 text-[8px] mt-4 leading-relaxed font-medium uppercase">
              Disclaimer: Data for educational purpose only. Derived from public sources. Verification recommended before trading. Gold rates are indicative MCX futures. Not a recommendation to buy or sell.
          </div>
      </div>
    </div>
  );
};

export default MarketSnapshotReport;
