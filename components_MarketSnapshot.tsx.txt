import React from 'react';
import { MarketSnapshotData } from '../types';
import { PieChart, Pie, Cell, ResponsiveContainer } from 'recharts';

interface Props {
  data: MarketSnapshotData;
  reportRef: React.RefObject<HTMLDivElement | null>;
}

const MarketSnapshotReport: React.FC<Props> = ({ data, reportRef }) => {
  const adData = [
    { name: 'Advances', value: data.advanceDecline.advances, color: '#10b981' },
    { name: 'Declines', value: data.advanceDecline.declines, color: '#ef4444' }
  ];

  const currentTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true });

  return (
    <div 
      ref={reportRef}
      className="w-[800px] bg-white overflow-hidden relative flex flex-col border border-slate-200"
      style={{ minHeight: '1200px' }}
    >
      {/* Institutional Header */}
      <div className="bg-[#0f172a] text-white p-10 relative overflow-hidden">
        <div className="absolute top-0 right-0 w-64 h-64 bg-orange-600/10 rounded-full -mr-32 -mt-32 blur-3xl"></div>
        <div className="relative flex justify-between items-end border-l-4 border-orange-500 pl-6">
            <div>
                <h1 className="text-4xl font-black uppercase tracking-tighter leading-none mb-2">Vivek Financial</h1>
                <p className="text-[10px] font-bold tracking-[0.4em] text-slate-400 uppercase">Automated Market Intelligence</p>
            </div>
            <div className="text-right">
                <div className="text-[10px] font-black text-orange-500 uppercase tracking-widest mb-1">CLOSING SUMMARY</div>
                <div className="text-2xl font-black tracking-tight tabular-nums">{data.date}</div>
                <div className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1">Generated at {currentTime}</div>
            </div>
        </div>
      </div>

      {/* Main Indices */}
      <div className="grid grid-cols-3 divide-x divide-slate-100 bg-slate-50/50 border-b border-slate-100">
        {[
          { label: 'NIFTY 50', val: data.indices.nifty50 },
          { label: 'SENSEX', val: data.indices.sensex },
          { label: 'NIFTY BANK', val: data.indices.niftyBank }
        ].map((index, i) => (
          <div key={i} className="p-8">
            <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">{index.label}</div>
            <div className="text-3xl font-black text-slate-900 leading-none mb-3 tabular-nums tracking-tighter">{index.val.value}</div>
            <div className={`flex items-center gap-2 font-bold text-sm ${index.val.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                {index.val.isPositive ? '▲' : '▼'} {index.val.change} 
                <span className="text-[10px] opacity-60">({index.val.percentChange})</span>
            </div>
          </div>
        ))}
      </div>

      {/* Breadth & Macro */}
      <div className="grid grid-cols-2 border-b border-slate-100 h-[300px]">
        <div className="p-10 border-r border-slate-100 flex items-center justify-between">
          <div className="flex-1">
            <h4 className="font-black text-slate-800 text-[11px] uppercase tracking-widest mb-6">Market Breadth (NSE)</h4>
            <div className="space-y-4">
                <div className="flex justify-between items-end border-b border-slate-50 pb-2">
                    <span className="text-[10px] font-bold text-slate-400 uppercase">Advances</span>
                    <span className="text-xl font-black text-emerald-600">{data.advanceDecline.advances}</span>
                </div>
                <div className="flex justify-between items-end border-b border-slate-50 pb-2">
                    <span className="text-[10px] font-bold text-slate-400 uppercase">Declines</span>
                    <span className="text-xl font-black text-rose-600">{data.advanceDecline.declines}</span>
                </div>
            </div>
          </div>
          <div className="w-32 h-32 ml-8">
                <ResponsiveContainer width="100%" height="100%">
                    <PieChart>
                        <Pie data={adData} innerRadius={40} outerRadius={50} paddingAngle={4} dataKey="value" stroke="none">
                            {adData.map((entry, index) => <Cell key={`cell-${index}`} fill={entry.color} />)}
                        </Pie>
                    </PieChart>
                </ResponsiveContainer>
          </div>
        </div>

        <div className="divide-y divide-slate-100 bg-slate-50/30">
          {[
            { label: 'Gold (MCX 10g)', data: data.commodities.gold },
            { label: 'Brent Crude ($)', data: data.commodities.oil },
            { label: 'USD / INR Spot', data: data.commodities.usdInr }
          ].map((c, i) => (
            <div key={i} className="px-10 py-6 flex items-center justify-between">
              <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">{c.label}</span>
              <div className="text-right">
                <div className="font-black text-slate-900 text-lg tabular-nums tracking-tight">{c.data.value}</div>
                <div className={`text-[10px] font-bold ${c.data.isPositive ? 'text-emerald-600' : 'text-rose-600'}`}>
                   {c.data.percentChange}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Movers */}
      <div className="grid grid-cols-2 divide-x divide-slate-100 flex-1">
        <div className="p-10">
          <h4 className="font-black text-emerald-600 text-[11px] uppercase tracking-widest mb-6 flex items-center gap-2">
            <i className="fa-solid fa-arrow-trend-up"></i> Top Gainers
          </h4>
          <div className="space-y-4">
            {data.gainers.slice(0, 5).map((s, i) => (
              <div key={i} className="flex justify-between items-center group">
                <div className="font-bold text-slate-800 text-sm">{s.company}</div>
                <div className="text-right">
                  <div className="text-[10px] font-medium text-slate-400 tabular-nums">{s.price}</div>
                  <div className="text-sm font-black text-emerald-600">+{s.percentChange}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
        <div className="p-10">
          <h4 className="font-black text-rose-600 text-[11px] uppercase tracking-widest mb-6 flex items-center gap-2">
             <i className="fa-solid fa-arrow-trend-down"></i> Top Losers
          </h4>
          <div className="space-y-4">
            {data.losers.slice(0, 5).map((s, i) => (
              <div key={i} className="flex justify-between items-center">
                <div className="font-bold text-slate-800 text-sm">{s.company}</div>
                <div className="text-right">
                  <div className="text-[10px] font-medium text-slate-400 tabular-nums">{s.price}</div>
                  <div className="text-sm font-black text-rose-600">{s.percentChange}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Institutional Activity */}
      <div className="mx-10 my-8 p-8 bg-[#0f172a] rounded-3xl text-white">
          <h4 className="font-black text-slate-500 text-[9px] uppercase tracking-[0.4em] mb-6 text-center">Institutional Cash Flow (₹ Cr)</h4>
          <div className="grid grid-cols-2 gap-12">
              <div className="text-center border-r border-slate-800">
                  <p className="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-2">FII Net Flow</p>
                  <p className={`text-2xl font-black tabular-nums ${data.fii.daily.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.fii.daily.net}</p>
              </div>
              <div className="text-center">
                  <p className="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-2">DII Net Flow</p>
                  <p className={`text-2xl font-black tabular-nums ${data.dii.daily.net.includes('-') ? 'text-rose-400' : 'text-emerald-400'}`}>{data.dii.daily.net}</p>
              </div>
          </div>
      </div>

      {/* Footer */}
      <div className="bg-slate-50 p-10 mt-auto border-t border-slate-100">
          <div className="flex items-center justify-between pb-6 border-b border-slate-200 mb-6">
            <div>
              <div className="text-slate-900 font-black text-xl tracking-tighter uppercase italic">Vivek Financial Focus Ltd.</div>
              <p className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mt-1">
                SEBI Registered Stock Broker | Member: NSE & BSE
              </p>
            </div>
            <div className="text-right">
                <div className="text-sm font-black text-slate-900">www.vivekfinancial.com</div>
            </div>
          </div>
          <p className="text-[8px] font-medium text-slate-400 text-center uppercase leading-relaxed max-w-lg mx-auto italic">
            Market investments are subject to risk. Data summarized for informational purposes only.
          </p>
      </div>
    </div>
  );
};

export default MarketSnapshotReport;